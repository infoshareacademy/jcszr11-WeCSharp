@using Schedulist.App.ViewModels
@using Schedulist.DAL.Models
@model WeekViewModel

@{
    ViewData["Title"] = "Week";
}
<script>
    function openCalendarSidebar(element) {
        closeCalendarSidebars()
        var sidebarId = element.getAttribute('data-sidebar-id');
        var sidebarElement = document.getElementById(sidebarId);
        sidebarElement.style.display = "block";
    }

    function closeCalendarSidebars() {
    @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
    {
        string sidebarId = $"calendarEvent{calendarEvent.Id}";
        @:closeCalendarSidebar('@sidebarId');
    }
        closeCalendarSidebar('Monday');
        closeCalendarSidebar('Tuesday');
        closeCalendarSidebar('Wednesday');
        closeCalendarSidebar('Thursday');
        closeCalendarSidebar('Friday');
        closeCalendarSidebar('Saturday');
        closeCalendarSidebar('Sunday');
        }

    function closeCalendarSidebar(sidebarId) {
        var sidebarElement = document.getElementById(sidebarId);
        sidebarElement.style.display = "none";
    }

    var calendarEventDeletedMessage = localStorage.getItem('calendarEventDeletedMessage');

    if (calendarEventDeletedMessage) {
        toastr.success(calendarEventDeletedMessage);
        localStorage.removeItem('calendarEventDeletedMessage');
    }
</script>

@* top menu *@
<div style="position: sticky; top: 0; z-index: 2;">
    <div class="row flex-nowrap month-name-container">
        <div class="button-field">
            <button type="button" class="btn btn-light" onclick="location.href='@Url.Action("Week", "Calendar", new {@date = Model.StartOfWeek.AddDays(-1), @userToEdit = Model.User})'"><</button>
        </div>
        <div class="button-field">
            <button type="button" class="btn btn-light" onclick="location.href='@Url.Action("Week", "Calendar", new {@date = Model.EndOfWeek.AddDays(1), @userToEdit = Model.User})'">></button>
        </div>
        <div class="month-name">
            @Model.StartOfWeek.ToString("dd MMMM yyyy") - @Model.EndOfWeek.ToString("dd MMMM yyyy")
        </div>
        <div class="calendar-dropdown">
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle month-view-dropdown" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Week
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a class="dropdown-item" onclick="location.href='@Url.Action("Day", "Calendar", new {@date = DateTime.Now, @userToEdit = Model.User.Id})'">Day</a>
                    <a class="dropdown-item" onclick="location.href='@Url.Action("ChangeUser", "Calendar", new {@date = DateTime.Now, @userToEdit = Model.User.Id})'">Month</a>
                </div>
            </div>
        </div>
        <div class="event-dropdown">
            <button class="btn btn-primary" onclick="location.href='@Url.Action("Create", "Calendar")'">
                Add new event
            </button>
        </div>
        <div class="month-user-name">
            @Model.User.Name @Model.User.Surname - @Model.WorkMode
        </div>
    </div>
    <div class="row day-calendar-row">
        <div class="col-1 day-calendar-row-hour calendar-header">Hour</div>
        <div class="col day-calendar-row-hour calendar-header pointer" data-sidebar-id="Monday" onclick="openCalendarSidebar(this)">Monday</div>
        <div class="col day-calendar-row-hour calendar-header pointer" data-sidebar-id="Tuesday" onclick="openCalendarSidebar(this)">Tuesday</div>
        <div class="col day-calendar-row-hour calendar-header pointer" data-sidebar-id="Wednesday" onclick="openCalendarSidebar(this)">Wednesday</div>
        <div class="col day-calendar-row-hour calendar-header pointer" data-sidebar-id="Thursday" onclick="openCalendarSidebar(this)">Thursday</div>
        <div class="col day-calendar-row-hour calendar-header pointer" data-sidebar-id="Friday" onclick="openCalendarSidebar(this)">Friday</div>
        <div class="col day-calendar-row-hour calendar-header pointer" data-sidebar-id="Saturday" onclick="openCalendarSidebar(this)">Saturday</div>
        <div class="col day-calendar-row-hour calendar-header pointer" data-sidebar-id="Sunday" onclick="openCalendarSidebar(this)">Sunday</div>
    </div>
</div>

@* calendar table *@
<div>
    @for (int i = 0; i < 24; i++)
    {
        <div class="row day-calendar-row">
            @if (i < 12)
            {
                if (i == 0)
                {
                    <div class="col-1 day-calendar-row-hour">12 AM</div>
                }
                else
                {
                    <div class="col-1 day-calendar-row-hour">@i AM</div>
                }
            }
            else
            {
                if (i == 12)
                {
                    <div class="col-1 day-calendar-row-hour">12 AM</div>
                }
                else
                {
                    <div class="col-1 day-calendar-row-hour">@i PM</div>
                }
            }
            <div class="col day-calendar-row-hour"></div>
            <div class="col day-calendar-row-hour"></div>
            <div class="col day-calendar-row-hour"></div>
            <div class="col day-calendar-row-hour"></div>
            <div class="col day-calendar-row-hour"></div>
            <div class="col day-calendar-row-hour"></div>
            <div class="col day-calendar-row-hour"></div>
        </div>
    }
</div>

@* calendar events *@
<div class="calendar-calendar-event-container">
    @if (@Model.CalendarEvents.Count > 0)
    {
        int day = 0;
        for (DateOnly date = Model.StartOfWeek; date <= Model.EndOfWeek; date = date.AddDays(1))
        {
            <div class="week-calendar-event-container" style="left: calc(100% / 7 * @day);">
                @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
                {
                    if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == date.DayOfWeek)
                    {
                        string top = $"{calendarEvent.CalendarEventStartTime.Hour * 60 + calendarEvent.CalendarEventStartTime.Minute}px";
                        var duration = calendarEvent.CalendarEventEndTime - calendarEvent.CalendarEventStartTime;
                        string height = $"{duration.Hours * 60 + duration.Minutes}px";
                        string sidebarId = $"calendarEvent{calendarEvent.Id}";
                        <div class="day-calendar-event" style="top: @top; height: @height;" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                            @calendarEvent.CalendarEventName
                        </div>
                    }
                }
            </div>
            day += 1;
        }
    }
</div>


@* week sidebar *@
<div>
    <div id="Monday" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            <h3>Monday</h3>
            @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
            {
                if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == DayOfWeek.Monday)
                {
                    string sidebarId = $"calendarEvent{calendarEvent.Id}";
                    <div class="calendar-sidebar-event-container pointer" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                        @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
                        @calendarEvent.CalendarEventName<br>
                        @calendarEvent.CalendarEventDescription<br>
                    </div>
                }
            }
            </button>
        </div>
    </div>
    <div id="Tuesday" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            <h3>Tuesday</h3>
            @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
            {
                if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == DayOfWeek.Tuesday)
                {
                    string sidebarId = $"calendarEvent{calendarEvent.Id}";
                    <div class="calendar-sidebar-event-container pointer" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                        @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
                        @calendarEvent.CalendarEventName<br>
                        @calendarEvent.CalendarEventDescription<br>
                    </div>
                }
            }
            </button>
        </div>
    </div>
    <div id="Wednesday" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            <h3>Wednesday</h3>
            @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
            {
                if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == DayOfWeek.Wednesday)
                {
                    string sidebarId = $"calendarEvent{calendarEvent.Id}";
                    <div class="calendar-sidebar-event-container pointer" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                        @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
                        @calendarEvent.CalendarEventName<br>
                        @calendarEvent.CalendarEventDescription<br>
                    </div>
                }
            }
            </button>
        </div>
    </div>
    <div id="Thursday" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            <h3>Thursday</h3>
            @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
            {
                if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == DayOfWeek.Thursday)
                {
                    string sidebarId = $"calendarEvent{calendarEvent.Id}";
                    <div class="calendar-sidebar-event-container pointer" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                        @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
                        @calendarEvent.CalendarEventName<br>
                        @calendarEvent.CalendarEventDescription<br>
                    </div>
                }
            }
            </button>
        </div>
    </div>
    <div id="Friday" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            <h3>Friday</h3>
            @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
            {
                if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == DayOfWeek.Friday)
                {
                    string sidebarId = $"calendarEvent{calendarEvent.Id}";
                    <div class="calendar-sidebar-event-container pointer" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                        @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
                        @calendarEvent.CalendarEventName<br>
                        @calendarEvent.CalendarEventDescription<br>
                    </div>
                }
            }
            </button>
        </div>
    </div>
    <div id="Saturday" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            <h3>Saturday</h3>
            @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
            {
                if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == DayOfWeek.Saturday)
                {
                    string sidebarId = $"calendarEvent{calendarEvent.Id}";
                    <div class="calendar-sidebar-event-container pointer" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                        @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
                        @calendarEvent.CalendarEventName<br>
                        @calendarEvent.CalendarEventDescription<br>
                    </div>
                }
            }
            </button>
        </div>
    </div>
    <div id="Sunday" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            <h3>Sunday</h3>
            @foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
            {
                if (calendarEvent.UserId == @Model.User.Id && calendarEvent.CalendarEventDate.DayOfWeek == DayOfWeek.Sunday)
                {
                    string sidebarId = $"calendarEvent{calendarEvent.Id}";
                    <div class="calendar-sidebar-event-container pointer" data-sidebar-id="@sidebarId" onclick="openCalendarSidebar(this)">
                        @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
                        @calendarEvent.CalendarEventName<br>
                        @calendarEvent.CalendarEventDescription<br>
                    </div>
                }
            }
            </button>
        </div>
    </div>
</div>

@* calendar event sidebar *@
@foreach (CalendarEvent calendarEvent in @Model.CalendarEvents)
{
    string sidebarId = $"calendarEvent{calendarEvent.Id}";
    <div id="@sidebarId" class="calendar-sidebar-container">
        <div class="calendar-sidebar">
            <button onclick="closeCalendarSidebars()" class="sidebar-close-button">x</button>
            @calendarEvent.CalendarEventStartTime - @calendarEvent.CalendarEventEndTime<br>
            @calendarEvent.CalendarEventName<br>
            @calendarEvent.CalendarEventDescription<br>
            <button class="btn btn-primary" onclick="location.href='@Url.Action("Edit", "CalendarEvent", new { id = calendarEvent.Id })'">
                Edit
            </button>
        </div>
    </div>
}
